# Copyright 2004 OTP Systems Oy. All rights reserved

# On Windows, the buildtms command will generate a warning about the
# locally defined symbol _JTux_xa_switch being imported in the
# function __tmgetsvrargs. This warning occurs because the server stub
# generated by buildtms/buildserver expects the JTux_xa_switch to be in
# a DLL. However, to avoid DLL complications when running multiple versions
# of JTux in parallel (especially on Unix) we have deciced to statically
# link the JTux_xa_switch to the JTMS executable. The warning appears
# to be harmless and can be ignored.

BASE_DIR := ..

default: all

include $(BASE_DIR)/Makefile.include

all: $(JTMS)

# On Unix, libJTux.a (which contains JTuxMainExit) must be passed to the
# linker *after* the generated server stub file. This is not possible
# using buildtms and that's why we use buildserver instead.

$(JTMS):
	-mkdir build
	cd build && buildserver -v -r JTux -o $(JTMS) -S -s TMS -s..TMS:TMS -f "-DTMMAINEXIT $(JTuxXASwitch) $(JTuxLibrary) $(OTPJNILibrary) $(OTPTuxedoLibrary) $(OTPPlatformLibrary) $(TUXDIR)/lib/TMS$(ObjSuffix)"
ifneq ($(PLATFORM),Windows)
	strip $(JTMS)
endif

clean:
	rm -rf build
