# Copyright 2004 OTP Systems Oy. All rights reserved.

BASE_DIR := ..

default: all

include $(BASE_DIR)/Makefile.include

all: $(JTuxInteropDLL) $(JTuxWSInteropDLL)

# On Windows, the command below will generate a warning about the locally
# defined symbol _JTux_xa_switch being imported in the function _tpinit.
# This warning occurs because the client stub generated by buildclient expects
# the JTux_xa_switch to be in a DLL. However, to make it easier to run
# multiple versions of JTux in parallel (especially on Unix) we have deciced
# to statically link the JTux_xa_switch to the JTuxInterop DLL. The warning
# appears to be harmless and can be ignored.

$(JTuxInteropDLL): build/JTuxInterop.h src/c/JTuxInterop.c
	-mkdir build
	cd build && buildclient -v -r JTux -o $(JTuxInteropDLL) -f "$(CFLAGS) $(DllCFlags) -I. ../src/c/JTuxInterop.c $(JTuxXASwitch) $(JTuxLibrary) $(OTPJNILibrary) $(OTPTuxedoLibrary) $(OTPPlatformLibrary) $(libtmib)"
ifneq ($(PLATFORM),Windows)
	strip $(JTuxInteropDLL)
endif

$(JTuxWSInteropDLL): build/JTuxInterop.h src/c/JTuxWSInterop.c
	-mkdir build
	cd build && buildclient -v -w -o $(JTuxWSInteropDLL) -f "$(CFLAGS) $(DllCFlags) -I. ../src/c/JTuxWSInterop.c $(JTuxLibrary) $(OTPJNILibrary) $(OTPTuxedoLibrary) $(OTPPlatformLibrary)"
ifneq ($(PLATFORM),Windows)
	strip $(JTuxInteropDLL)
endif

build/JTuxInterop.h:
	-mkdir build
	$(javah) -o build/JTuxInterop.h jtux.JTuxInterop

clean:
	rm -rf build
